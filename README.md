Вы столкнулись с задачей разработки чат-бота, а потому я предлагаю посмотреть план ниже, который стоило бы заполнить перед тем, как начать разрабатывать систему:

# Design-Doc: Чат-бот / RAG-система

/ основан на шаблоне команды [Reliable ML](https://github.com/IrinaGoloshchapova/ml_system_design_doc_ru/blob/main/ML_System_Design_Doc_Template.md) /

(Заполняется проектной командой: бизнес-заказчик, ML/инженеры, продуктовая команда)

## 1. Контекст проекта

### 1.1 Бизнес-задача
Проблема: абитуриенты задают много повторяющихся вопросов о поступлении, а информация разбросана, поэтому ответы ищутся долго.
Что пытаемся решить: сократить время ответа и нагрузку на приёмную комиссию за счёт автоматизации ответов на повторяющиеся вопросы абитуриентов (FAQ), чтобы пользователи получали информацию сразу, а сотрудники отвечали только на нестандартные случаи.

Почему чат-бот/RAG: бот может быстро находить ответ в официальных источниках и формулировать понятный ответ на естественном языке. RAG уменьшает “придумывание” и позволяет давать ссылки на источник.

Критерии успеха: бот отвечает на частые вопросы абитуриентов, ответы правильные и по официальным источникам (со ссылкой), абитуриенты получают информацию быстрее, а в приёмную комиссию приходит меньше одинаковых вопросов.

Если у нас есть готовое решение, то мы говорим об улучшении текущего опыта; лучше не говорить напрямую о том, что вы хотите сократить штат и кого-то уволить, даже если это правда ваша цель (пожалуйста, думайте об этике). Если решения нет, то надо решение оправдать.

Во введении / актуальности работы: почему без чат-бота не справиться?

На третий вопрос не обязательно отвечать в рамках работы, но важно хотя бы представлять, как будет измеряться успешность исполнения задачи и успешность самого решения. "что мы считаем успехом". *Курсив*

### 1.2 Целевая аудитория и пользователи
Кто будет пользоваться ботом: абитуриенты НИУ ВШЭ (бакалавриат/магистратура), их родители.

Сценарии использования: текстовый чат (Telegram-бот). Пользователь задаёт вопрос про поступление, а бот отвечает и при необходимости даёт ссылку на официальный источник или контакт приёмной комиссии.

Предполагаемая нагрузка: Пиковая нагрузка в период с апреля по август. Для прототипа ожидается ожидается 50-200 активных пользователей в неделю.

Вопрос в цене ошибки, + вопрос в пользовательских сценариях и их поведении. Из-за того, с кем мы общаемся и где мы общаемся, мы можем варьировать как контент на входе, так и на выходе.

### 1.3 Ограничения и допущения
Что нельзя/не будет делать бот: бот отвечает только про поступление в НИУ ВШЭ и только по официальным источникам; не принимает документы/заявки, в случае вопроса не по теме поступления отправляет ссылку на официальный контакт.


Данные: используем только официальные публичные источники НИУ ВШЭ, без персональных данных.
Актуальность: данные могут меняться, поэтому базу знаний обновляем периодически.

Инфраструктура: прототип разворачивается локально/в Docker (бот + сервис + Qdrant).

Безопасность: бот не запрашивает и не хранит персональные данные.

Нормативы: соблюдаем требования по персональным данным (не собираем/не обрабатываем ПДн) и используем только материалы с официальных сайтов.


Про: репутационные риски, хотим ли мы отвечать на вопросы не по предметной области чат-бота?

## 2. Архитектура решения

### 2.1 Общая схема
Диаграмма архитектуры: фронт-энд (чат-интерфейс) → API → RAG-движок → база/хранилище знаний → LLM → пост-обработка.

Компоненты:

Интерфейс: принимает вопрос и показывает ответ.

API/бэкенд: маршрутизация запросов, логика диалога.

RAG-сервис: формирует запрос к поиску, собирает контекст, вызывает LLM.

База знаний: чанки + метаданные в Qdrant.

LLM: пишет ответ по контексту.

Промпт: храни тся в коде/конфиге RAG-сервиса (файл/переменная окружения).

Буду спрашивать со всех: где лежит бд, когда мы в неё стучимся, где лежит промпт, в каком порядке обрабатываем пользовательские запросы?

### 2.2 Хранилище знаний / документооборот
Источники знаний: официальные страницы сайта НИУ ВШЭ по поступлению (HTML) и официальные документы (PDF: правила приема, памятки, FAQ и т.п.).

Где храним:
Тексты после извлечения и список ссылок храним в репозитории. Для поиска храним чанки и метаданные в Qdrant.

Предобработка:
Извлекаем текст из PDF/HTML, убираем мусор (меню, повторяющиеся блоки), приводим к одному формату, делим на смысловые фрагменты (чанки), добавляем метаданные (ссылка, название, раздел, дата, тип).

Индексация:
Для каждого чанка считаем эмбеддинг и загружаем в Qdrant вместе с метаданными. Поиск выполняется по близости эмбеддингов, возвращаем top-k релевантных фрагментов.

Обновление данных: обновляем раз в 1-2 недели или при изменении на сайте.

Как часто обновляем данные? Где храним? Что храним? в каком виде? Где оно лежит, если нужно будет обновить? (Парсинг или ручное обновление)

### 2.3 Retrieval + Generation
Retrieval: векторный поиск по чанкам в базе (Qdrant), возвращаем top-k фрагментов. Эмбеддинги считаем одной моделью для документов и запросов.

Generation: LLM получает вопрос + найденные фрагменты и пишет ответ на русском языке, добавляет ссылки на источники.

Контроль ответа: если релевантных фрагментов нет, бот пишет, что точной информации не нашел, и предлагает официальный источник/контакты. Ответы ограничиваем темой поступления.

-- технические решения, можно к КТ1 не писать, но просто прикинуть, что будет актуально; но аргументировать выбор перед защитой на основе бизнес-требований.

### 2.4 Интеграции и интерфейсы
	•	Внешние API и сервисы: чат-интерфейс, CRM, база пользователей, логирование.
	•	Протоколы: REST, gRPC, WebSockets, Webhook.
	•	UI/UX: как выглядит чат, переходы, кнопки, предложения.
	•	Мониторинг: логирование запросов/ответов, аналитика, алерты.

### 2.5 Инфраструктура и развертывание
	•	Архитектурный стек: контейнеры (Docker), оркестрация (Kubernetes), серверless.
	•	Среды: dev/test/prod.
	•	Требования к вычислениям: GPU или CPU, память, хранилище.
	•	Безопасность: аутентификация, авторизация, шифрование, GDPR/нормы.
	•	Масштабирование: горизонтальное, резервирование, локализация.

## 3. Данные и качество знаний

Пометка: содежат ли документы чувствительные данные (можно ли это отправлять "во вне", например, в GPT, или можно только локальные модели; может быть придётся замаскировать данные?)

### 3.1 Сбор и предобработка данных
Источники: официальные страницы сайта НИУ ВШЭ по поступлению (HTML) и официальные документы (PDF: правила приема, памятки, FAQ и т.п.). После извлечения текст храним в текстовом виде (TXT/JSON) для загрузки в базу знаний.

Шаги предобработки: извлечение текста из PDF/HTML, очистка от мусора и повторов, нормализация, разбиение на смысловые фрагменты (чанки), при необходимости удаление дубликатов.

Метаданные: ссылка на источник, название документа/страницы, раздел, дата обновления/публикации, тип источника (PDF/HTML).

### 3.2 Векторизация и индексирование
Модель embedding:
Используем multilingual sentence-transformers для русского. Эмбеддинги считаем для документов и запросов, точную модель выберу после сравнения нескольких.

Параметры индекса:
Qdrant, метрика cosine. Храним эмбеддинги чанков и метаданные. Одна коллекция, без shards/replicas.

Стратегии обновления:
Добавляем/обновляем измененные чанки. При смене модели или настроек чанков пересобираем индекс полностью.

### 3.3 Метрики качества знаний
Покрытие: база включает ключевые разделы про поступление, 80-90% ключевых разделов покрыто.

Актуальность: обновляем базу раз в 1-2 недели и при изменениях на сайте.

Консистентность: удаляем дубли и следим, чтобы ответы опирались на один источник (самый актуальныи).

Проверка: ручная проверка на "золотом наборе" вопросов и фиксация частых ошибок для доработки.

## 4. Модель и генерация

### 4.1 Выбор LLM и промптинг
	Указание модели: для прототипа используем GPT (через API) как базовую LLM, так как она хорошо отвечает на русском и дает стабильное качество. При необходимости позже сравним с open-source моделями (Mistral/Qwen).

	Промпт-шаблон:
	Входные данные: вопрос пользователя + top-k найденных фрагментов из базы (с 	Инструкции: отвечай только по предоставленному контексту, не выдумывай, если информации нет - скажи об этом.
	Формат ответа: короткий ответ на русском + 1-3 ссылки на источники (url), при необходимости список шагов/пунктов.

	Ограничения: ограничиваем длину ответа (например до 150-250 слов), используем фиксированный top-k (например 3-5), выставляем max_tokens, чтобы ответ был коротким и быстрым.

### 4.2 Контроль качества ответов
	•	Метрики: точность, полнота/coverage, полезность, удовлетворённость пользователя.
	•	Оценка ошибок: нежелательные ответы, hallucinations, офтопик.
	•	Механизмы: ручной ревью, эвристики (например “если confidence < x, дефолтный ответ”), fallback на статический контент.

### 4.3 Обучение/дообучение
	Fine-tuning/RLHF: для прототипа не делаем. Качество улучшаем базои знании, настроиками retrieval и промптом.

	Версионирование и rollback: фиксируем версии промпта, embedding-модели, параметров чанков и коллекции Qdrant. При ухудшении качества откатываемся на предыдущую стабильную версию (прошедшую тест на "золотом наборе").

## 5. UX / пользовательский опыт

Важно: пункт 5.1 -- он определяет частично БФТ. Что делать, если не смогли ответить? Продумать, где мы можем накосячить и как это обработать?

### 5.1 Сценарии взаимодействия
	Основные сценарии:

	Приветствие: бот объясняет, что умеет (вопросы про поступление), и предлагает примеры вопросов.

	Поиск по знаниям: пользователь задает вопрос, бот отвечает и дает ссылку на источник.

	Уточнение: если вопрос слишком общий, бот задает 1 уточняющий вопрос.

	Многошаговый диалог: пользователь задает уточнения, бот продолжает отвечать в рамках темы.

	Исключительные сценарии:

	Нет ответа: бот пишет, что точной информации не нашел, и дает ссылку на официальный контакт приемной комиссии.

	Не понял вопрос: просит переформулировать и предлагает варианты.

	Перенос к оператору: дает ссылку на официальный контакт приемной комиссии.

### 5.2 Диалоговая логика
	Состояния: поддерживаем single-turn и multi-turn. Если вопрос общий, бот задает 1 уточняющий вопрос и продолжает диалог.

	Контекст: храним только короткое окно последних сообщений (например 3-5) для продолжения диалога. Долгую "память пользователя" не ведем.

	Тон и стиль: ответы на русском, вежливо и коротко, по пунктам. Без лишних эмодзи. В конце по возможности даем ссылку на источник или куда обратиться.
Храним ли мы историю общения с пользователем? Если да, то как? В каком тоне отвечаем?

### 5.3 Метрики UX
	Время ответа: целимся в 3-10 секунд на ответ.

	Оценка полезности: реакция "лайк/дизлайк" под ответом, считаем процент положительных оценок.

	Логирование: храним технические метрики (время ответа, какие источники использовали, оценка лайк/дизлайк), без персональных данных.

	NPS/опрос: короткий вопрос "порекомендуете ли бота?" по желанию.

Как быстро нужно отвечать? Может быть надо как-то взаимодействовать с пользователем в рамках получения фидбэка (лайк/дизлайк). Нужно ли логгировать работу бота для отслеживания качества работы?

## 6. Безопасность, соответствие и этика
	Персональные данные: бот не запрашивает и не хранит персональные данные. Если пользователь сам написал личную информацию, мы ее не сохраняем в логах и не используем в ответе.

	Нежелательный контент: ответы ограничены темой поступления. На оффтоп или небезопасные запросы бот вежливо отказывает и предлагает официальные контакты приемной комиссии.

	Прозрачность: в приветствии указано, что это чат-бот, и что ответы формируются по официальным источникам. Также предупреждаем "не вводите персональные данные".

	Регулирования: используем только публичные официальные материалы и соблюдаем базовые требования по защите данных (не собираем/не обрабатываем ПДн).

## [OPTIONAL] 7. План внедрения и эксплуатации

Скорее актуально для рабочего проекта и его запуска.
### 7.1 Этапы проекта
	•	Фаза 0: исследование/документирование.
	•	Фаза 1: MVP (минимально жизнеспособный бот).
	•	Фаза 2: расширение функциональности, RAG-дополнения.
	•	Фаза 3: масштабирование, оптимизация.
	•	Вехи, сроки, ответственные.

### 7.2 Поддержка и эксплуатация
	•	Кто отвечает за поддержку (SRE, DevOps, чат-бот команда).
	•	Мониторинг: логирование ошибок, SLA, alerts, dashboards.
	•	Обновление знаний: план синхронизации, процесс ревью.
	•	Метрики эксплуатации: uptime, latency, cost per session.

## 8. Риски и допущения
	•	Список основных рисков (например: модель даёт неточные ответы, база знаний недостаточна, бюджет/ресурсы ограничены).
	•	Вероятность и влияние, стратегия уменьшения (mitigation).
	•	Ключевые допущения, которые не проверены.

## 9. [OPTIONAL] Бюджет и ресурсы
Скорее актуально для рабочего проекта и его запуска.
	•	Человеческие ресурсы: ML инженер, NLP инженер, DevOps, UX дизайнер, контент-менеджер.
	•	Технологические ресурсы: вычислительные ресурсы (GPU/CPU), лицензии, облачные сервисы.
	•	Примерные затраты (CAPEX, OPEX).
	•	ROI оценки: ожидаемое снижение затрат, ускорение ответа, рост удовлетворённости.

## 10. Приложения
Что-то, что стоит прописать в тексте работы во введении.
	•	Словарь терминов и аббревиатур.
	•	Ссылки на специфические документы: требования безопасности, регламент, UX-гайд, API-спецификации.
	•	Диаграммы, схемы, mock-up интерфейсов.
	•	Чек-лист готовности к запуску.


# Шаблон для заполнения:

# Design-Doc: Чат-бот / RAG-система  
*(Заполняется проектной командой: бизнес-заказчик, ML/инженеры, продуктовая команда)*

## 1. Контекст проекта  
### 1.1 Бизнес-задача  
-  
-  
-  

### 1.2 Целевая аудитория и пользователи  
-  
-  
-  

### 1.3 Ограничения и допущения  
-  
-  
-  

## 2. Архитектура решения  
### 2.1 Общая схема  
-  
-  

### 2.2 Хранилище знаний / документооборот  
-  
-  
-  

### 2.3 Retrieval + Generation  
-  
-  
-  

### 2.4 Интеграции и интерфейсы  
-  
-  

### 2.5 Инфраструктура и развертывание  
-  
-  
-  

## 3. Данные и качество знаний  
### 3.1 Сбор и предобработка данных  
-  
-  
-  

### 3.2 Векторизация и индексирование  
-  
-  
-  

### 3.3 Метрики качества знаний  
-  
-  
-  

## 4. Модель и генерация  
### 4.1 Выбор LLM и промптинг  
-  
-  
-  

### 4.2 Контроль качества ответов  
-  
-  
-  

### 4.3 Обучение/дообучение  
-  
-  
-  

## 5. UX / пользовательский опыт  
### 5.1 Сценарии взаимодействия  
-  
-  
-  

### 5.2 Диалоговая логика  
-  
-  
-  

### 5.3 Метрики UX  
-  
-  
-  

## 6. Безопасность, соответствие и этика  
-  
-  
-  
-  

## 7. План внедрения и эксплуатации  
### 7.1 Этапы проекта  
-  
-  
-  

### 7.2 Поддержка и эксплуатация  
-  
-  
-  

## 8. Риски и допущения  
-  
-  
-  
-  

## 9. Бюджет и ресурсы  
- Человеческие ресурсы:  
  -  
- Технологические ресурсы:  
  -  
- Примерные затраты:  
  -  
- ROI оценки:  
  -  

## 10. Приложения  
- Словарь терминов и аббревиатур  
- Ссылки на специфические документы  
- Диаграммы, схемы, mock-up интерфейсы  
- Чек-лист готовности к запуску  


```python

```
